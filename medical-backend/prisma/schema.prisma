generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model auth_logs {
  id         Int       @id @default(autoincrement())
  user_id    Int?
  ip         String?   @db.VarChar(100)
  user_agent String?
  success    Boolean?
  timestamp  DateTime? @default(now()) @db.Timestamp(6)
  users      users?    @relation(fields: [user_id], references: [id], onUpdate: NoAction)
}

model blockchain_events {
  id           Int       @id @default(autoincrement())
  tx_hash      String    @db.VarChar(100)
  event_name   String    @db.VarChar(255)
  block_number Int?
  payload      Json?
  created_at   DateTime? @default(now()) @db.Timestamp(6)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model doctor_profiles {
  user_id          Int       @id
  specialization   String?   @db.VarChar(255)
  experience_years Int?
  license_number   String?   @unique @db.VarChar(255)
  updated_at       DateTime? @default(now()) @db.Timestamp(6)
  users            users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model medical_files {
  id                                    Int       @id @default(autoincrement())
  patient_id                            Int?
  doctor_id                             Int?
  ipfs_hash                             String    @db.VarChar(255)
  file_type                             String?   @db.VarChar(100)
  metadata                              Json?
  created_at                            DateTime? @default(now()) @db.Timestamp(6)
  users_medical_files_doctor_idTousers  users?    @relation("medical_files_doctor_idTousers", fields: [doctor_id], references: [id], onUpdate: NoAction)
  users_medical_files_patient_idTousers users?    @relation("medical_files_patient_idTousers", fields: [patient_id], references: [id], onUpdate: NoAction)
}

model ml_measurements {
  id               Int       @id @default(autoincrement())
  patient_id       Int
  measurement_type String    @db.VarChar(100)
  value            Decimal   @db.Decimal
  source           String?   @db.VarChar(100)
  created_at       DateTime? @default(now()) @db.Timestamp(6)
  users            users     @relation(fields: [patient_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model ml_predictions {
  id         Int       @id @default(autoincrement())
  patient_id Int
  model_name String    @db.VarChar(255)
  prediction Json
  created_at DateTime? @default(now()) @db.Timestamp(6)
  users      users     @relation(fields: [patient_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model patient_profiles {
  user_id            Int       @id
  age                Int?
  gender             String?   @db.VarChar(20)
  allergies          String[]
  chronic_conditions String[]
  updated_at         DateTime? @default(now()) @db.Timestamp(6)
  users              users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model prescriptions_local {
  id              Int       @id @default(autoincrement())
  patient_wallet  String    @db.VarChar(42)
  doctor_wallet   String    @db.VarChar(42)
  medication_name String
  dosage          String?
  schedule        String?
  timestamp       DateTime? @db.Timestamp(6)
  ipfs_hash       String?   @db.VarChar(255)
  synced_at       DateTime? @default(now()) @db.Timestamp(6)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model users {
  id                                            Int               @id @default(autoincrement())
  wallet                                        String            @unique @db.VarChar(42)
  email                                         String?           @unique @db.VarChar(255)
  password_hash                                 String?
  role                                          String            @db.VarChar(20)
  full_name                                     String?           @db.VarChar(255)
  created_at                                    DateTime?         @default(now()) @db.Timestamp(6)
  is_active                                     Boolean           @default(true)
  auth_logs                                     auth_logs[]
  doctor_profiles                               doctor_profiles?
  medical_files_medical_files_doctor_idTousers  medical_files[]   @relation("medical_files_doctor_idTousers")
  medical_files_medical_files_patient_idTousers medical_files[]   @relation("medical_files_patient_idTousers")
  ml_measurements                               ml_measurements[]
  ml_predictions                                ml_predictions[]
  patient_profiles                              patient_profiles?
}
